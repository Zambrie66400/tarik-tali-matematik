<!doctype html>
<html lang="ms">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tarik Tali Matematik</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Comic Sans MS', 'Chalkboard SE', 'Comic Neue', cursive, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100%;
      width: 100%;
      overflow-x: hidden;
    }
    
    * {
      box-sizing: border-box;
    }
    
    .game-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      width: 100%;
    }
    
    .game-header {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .game-title {
      font-size: 2.5em;
      font-weight: bold;
      color: #ffffff;
      text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
      margin: 0 0 10px 0;
      border: 4px solid #ffffff;
      border-style: ridge;
      padding: 20px 30px;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.3), inset 0 2px 4px rgba(255,255,255,0.3);
    }
    
    .copyright-text {
      text-align: center;
      color: #ffffff;
      font-size: 0.9em;
      margin-top: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      font-weight: bold;
    }
    
    .settings-panel {
      background: rgba(255,255,255,0.95);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }
    
    .settings-row {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 15px;
      align-items: center;
      justify-content: center;
    }
    
    .setting-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .setting-group label {
      font-weight: bold;
      font-size: 0.9em;
      color: #333;
    }
    
    .setting-group select,
    .setting-group input {
      padding: 8px 12px;
      border: 2px solid #667eea;
      border-radius: 10px;
      font-size: 1em;
      background: white;
      min-width: 150px;
    }
    
    .btn-start {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 1.2em;
      font-weight: bold;
      border-radius: 30px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(245,87,108,0.4);
      transition: transform 0.2s;
    }
    
    .btn-start:hover {
      transform: scale(1.05);
    }
    
    .btn-start:active {
      transform: scale(0.98);
    }
    
    .game-board {
      background: rgba(255,255,255,0.95);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      display: none;
    }
    
    .game-board.active {
      display: block;
    }
    
    .players-area {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      gap: 20px;
    }
    
    .player-box {
      flex: 1;
      text-align: center;
      padding: 20px;
      border-radius: 15px;
      min-width: 150px;
    }
    
    .player-left {
      background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    }
    
    .player-right {
      background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
    }
    
    .player-name {
      font-size: 1.5em;
      font-weight: bold;
      color: white;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      margin-bottom: 5px;
    }
    
    .player-score {
      font-size: 2em;
      font-weight: bold;
      color: white;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .rope-container {
      position: relative;
      height: 80px;
      background: linear-gradient(to bottom, #e0e0e0 0%, #f5f5f5 100%);
      border-radius: 15px;
      margin-bottom: 30px;
      overflow: hidden;
      box-shadow: inset 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .rope-track {
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 4px;
      background: repeating-linear-gradient(
        90deg,
        #8b4513 0px,
        #8b4513 10px,
        #a0522d 10px,
        #a0522d 20px
      );
      transform: translateY(-50%);
    }
    
    .rope-marker {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
      border-radius: 50%;
      border: 4px solid #ff6b6b;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5em;
      font-weight: bold;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: left 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      z-index: 10;
    }
    
    .center-line {
      position: absolute;
      top: 0;
      left: 50%;
      width: 3px;
      height: 100%;
      background: rgba(255,107,107,0.5);
      transform: translateX(-50%);
    }
    
    .question-area {
      background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .turn-indicator {
      font-size: 1.1em;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
    }
    
    .question-text {
      font-size: 2.5em;
      font-weight: bold;
      color: #333;
      margin: 0 20px;
    }
    
    .timer-bar-container {
      width: 100%;
      height: 30px;
      background: rgba(255,255,255,0.5);
      border-radius: 15px;
      overflow: hidden;
      margin-bottom: 25px;
      border: 2px solid rgba(0,0,0,0.1);
    }
    
    .timer-bar {
      height: 100%;
      background: linear-gradient(90deg, #4ade80 0%, #22c55e 100%);
      transition: width 0.1s linear;
      border-radius: 15px;
    }
    
    .question-with-answers {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }
    
    .player-answer-section {
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: center;
    }
    
    .answer-label {
      font-weight: bold;
      font-size: 1.1em;
      color: #333;
    }
    
    .answer-input-inline {
      width: 100px;
      padding: 15px 10px;
      font-size: 1.8em;
      text-align: center;
      border: 3px solid #667eea;
      border-radius: 15px;
      font-weight: bold;
    }
    
    .answer-input-inline:focus {
      outline: none;
      border-color: #f5576c;
      box-shadow: 0 0 0 3px rgba(245,87,108,0.2);
    }
    
    .feedback-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: white;
      padding: 40px 60px;
      border-radius: 20px;
      font-size: 3em;
      font-weight: bold;
      box-shadow: 0 8px 30px rgba(0,0,0,0.3);
      z-index: 1000;
      transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      pointer-events: none;
    }
    
    .feedback-message.show {
      transform: translate(-50%, -50%) scale(1);
    }
    
    .feedback-message.correct {
      color: #22c55e;
    }
    
    .feedback-message.wrong {
      color: #ef4444;
    }
    
    .game-over-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }
    
    .game-over-screen.show {
      display: flex;
    }
    
    .game-over-content {
      background: white;
      padding: 50px;
      border-radius: 30px;
      text-align: center;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
      max-width: 600px;
    }
    
    .winner-text {
      font-size: 3em;
      font-weight: bold;
      margin-bottom: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .winner-emoji {
      font-size: 5em;
      margin-bottom: 20px;
    }
    
    .win-record-popup {
      background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
      padding: 20px;
      border-radius: 15px;
      margin: 20px 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .win-record-title {
      font-size: 1.3em;
      font-weight: bold;
      color: #2d3436;
      margin-bottom: 15px;
    }
    
    .win-record-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255,255,255,0.7);
      padding: 12px 20px;
      margin: 8px 0;
      border-radius: 10px;
      border: 2px solid #fff;
    }
    
    .win-record-name {
      font-size: 1.2em;
      font-weight: bold;
      color: #2d3436;
    }
    
    .win-record-count {
      font-size: 1.5em;
      font-weight: bold;
      color: #d63031;
      background: white;
      padding: 5px 15px;
      border-radius: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    
    .game-over-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .btn-restart {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 1.3em;
      font-weight: bold;
      border-radius: 30px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(102,126,234,0.4);
      transition: transform 0.2s;
    }
    
    .btn-restart:hover {
      transform: scale(1.05);
    }
    
    .btn-exit {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 1.3em;
      font-weight: bold;
      border-radius: 30px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(239,68,68,0.4);
      transition: transform 0.2s;
    }
    
    .btn-exit:hover {
      transform: scale(1.05);
    }
    
    .firework {
      position: fixed;
      pointer-events: none;
      z-index: 1999;
    }
    
    .firework-particle {
      position: absolute;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      animation: explode 1s ease-out forwards;
    }
    
    @keyframes explode {
      0% {
        transform: translate(0, 0) scale(1);
        opacity: 1;
      }
      100% {
        transform: translate(var(--tx), var(--ty)) scale(0);
        opacity: 0;
      }
    }
    
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      pointer-events: none;
      z-index: 1999;
      animation: confetti-fall 3s ease-out forwards;
    }
    
    @keyframes confetti-fall {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }
    
    @media (max-width: 768px) {
      .game-title {
        font-size: 2em;
      }
      
      .question-text {
        font-size: 2em;
      }
      
      .player-name {
        font-size: 1.2em;
      }
      
      .settings-row {
        flex-direction: column;
      }
      
      .setting-group {
        width: 100%;
      }
      
      .setting-group select,
      .setting-group input {
        width: 100%;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="game-container">
   <div class="game-header">
    <h1 class="game-title" id="gameTitle">Tarik Tali Matematik</h1>
    <div class="copyright-text">
     Hak Cipta: 2025@ZAMBRIE BIN MOHAMMED<br>
      SK BUKIT CERMIN
    </div>
   </div>
   <div class="settings-panel" id="settingsPanel">
    <div id="winRecordTable" style="display: none; margin-bottom: 20px; background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%); padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
     <h2 style="text-align: center; color: #2d3436; margin: 0 0 15px 0; font-size: 1.5em;">üìä Jadual Rekod Kemenangan</h2>
     <table style="width: 100%; border-collapse: collapse;">
      <thead>
       <tr style="background: rgba(255,255,255,0.7);">
        <th style="padding: 12px; text-align: left; border: 2px solid #fff; font-size: 1.1em;">Pemain</th>
        <th style="padding: 12px; text-align: center; border: 2px solid #fff; font-size: 1.1em;">Jumlah Menang</th>
       </tr>
      </thead>
      <tbody>
       <tr style="background: rgba(250,112,154,0.3);">
        <td style="padding: 12px; border: 2px solid #fff; font-weight: bold; font-size: 1.1em;" id="recordNameLeft">Pemain Kiri</td>
        <td style="padding: 12px; border: 2px solid #fff; text-align: center; font-size: 1.3em; font-weight: bold; color: #d63031;" id="recordWinsLeft">0</td>
       </tr>
       <tr style="background: rgba(48,207,208,0.3);">
        <td style="padding: 12px; border: 2px solid #fff; font-weight: bold; font-size: 1.1em;" id="recordNameRight">Pemain Kanan</td>
        <td style="padding: 12px; border: 2px solid #fff; text-align: center; font-size: 1.3em; font-weight: bold; color: #0984e3;" id="recordWinsRight">0</td>
       </tr>
      </tbody>
     </table>
    </div>
    <div class="settings-row">
     <div class="setting-group"><label>Nama Pemain Kiri:</label> <input type="text" id="nameLeft" placeholder="Masukkan nama" value="">
     </div>
     <div class="setting-group"><label>Nama Pemain Kanan:</label> <input type="text" id="nameRight" placeholder="Masukkan nama" value="">
     </div>
    </div>
    <div class="settings-row">
     <div class="setting-group"><label>Operasi:</label> <select id="operationSelect"> <option value="mixed">Campur Semua</option> <option value="add">Tambah (+)</option> <option value="subtract">Tolak (‚àí)</option> <option value="multiply">Darab (√ó)</option> <option value="divide">Bahagi (√∑)</option> </select>
     </div>
     <div class="setting-group"><label>Masa Jawab (saat):</label> <input type="number" id="timeLimit" value="10" min="5" max="30">
     </div>
    </div>
    <div class="settings-row"><button class="btn-start" id="startBtn">Mula Permainan! üéÆ</button>
    </div>
   </div>
   <div class="game-board" id="gameBoard">
    <div class="players-area">
     <div class="player-box player-left">
      <div class="player-name" id="playerLeftName">
       Pemain Kiri
      </div>
      <div class="player-score" id="scoreLeft">
       0
      </div>
     </div>
     <div class="player-box player-right">
      <div class="player-name" id="playerRightName">
       Pemain Kanan
      </div>
      <div class="player-score" id="scoreRight">
       0
      </div>
     </div>
    </div>
    <div class="rope-container">
     <div class="center-line"></div>
     <div class="rope-track"></div>
     <div class="rope-marker" id="ropeMarker">
      üéØ
     </div>
    </div>
    <div class="question-area">
     <div class="turn-indicator" id="turnIndicator">
      Giliran: Pemain Kiri
     </div>
     <div class="timer-bar-container">
      <div class="timer-bar" id="timerBar"></div>
     </div>
     <div class="question-with-answers">
      <div class="player-answer-section">
       <div class="answer-label" id="labelLeft">
        Pemain Kiri
       </div><input type="number" class="answer-input-inline" id="answerLeft" placeholder="?">
      </div>
      <div class="question-text" id="questionText">
       5 + 3 = ?
      </div>
      <div class="player-answer-section">
       <div class="answer-label" id="labelRight">
        Pemain Kanan
       </div><input type="number" class="answer-input-inline" id="answerRight" placeholder="?">
      </div>
     </div>
    </div>
   </div>
  </div>
  <div class="feedback-message" id="feedbackMessage"></div>
  <div class="game-over-screen" id="gameOverScreen">
   <div class="game-over-content">
    <div class="winner-emoji">
     üèÜ
    </div>
    <div class="winner-text" id="winnerText">
     Pemain Kiri Menang!
    </div>
    <div class="win-record-popup">
     <div class="win-record-title">
      üìä Rekod Kemenangan
     </div>
     <div class="win-record-row"><span class="win-record-name" id="popupNameLeft">Zam</span> <span class="win-record-count" id="popupWinsLeft">4</span>
     </div>
     <div class="win-record-row"><span class="win-record-name" id="popupNameRight">Cath</span> <span class="win-record-count" id="popupWinsRight">0</span>
     </div>
    </div>
    <div class="game-over-buttons"><button class="btn-restart" id="restartBtn">Main Lagi! üéÆ</button> <button class="btn-exit" id="exitBtn">Keluar ‚ùå</button>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      game_title: "Tarik Tali Matematik",
      player_left_name: "Pemain Kiri",
      player_right_name: "Pemain Kanan",
      correct_message: "Betul!",
      wrong_message: "Cuba Lagi!"
    };

    let gameState = {
      markerPosition: 50,
      scoreLeft: 0,
      scoreRight: 0,
      currentTurn: 'left',
      currentQuestion: null,
      correctAnswer: null,
      timerInterval: null,
      timeRemaining: 10,
      winLimit: 5,
      timeLimit: 10,
      operation: 'mixed',
      gameActive: false,
      totalWinsLeft: 0,
      totalWinsRight: 0
    };

    async function onConfigChange(config) {
      document.getElementById('gameTitle').textContent = config.game_title || defaultConfig.game_title;
      document.getElementById('playerLeftName').textContent = config.player_left_name || defaultConfig.player_left_name;
      document.getElementById('playerRightName').textContent = config.player_right_name || defaultConfig.player_right_name;
      document.getElementById('labelLeft').textContent = config.player_left_name || defaultConfig.player_left_name;
      document.getElementById('labelRight').textContent = config.player_right_name || defaultConfig.player_right_name;
      
      if (gameState.gameActive) {
        updateTurnIndicator();
      }
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ["game_title", config.game_title || defaultConfig.game_title],
        ["player_left_name", config.player_left_name || defaultConfig.player_left_name],
        ["player_right_name", config.player_right_name || defaultConfig.player_right_name],
        ["correct_message", config.correct_message || defaultConfig.correct_message],
        ["wrong_message", config.wrong_message || defaultConfig.wrong_message]
      ]);
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }

    function generateQuestion(operation) {
      let num1, num2, answer, questionStr, op;
      const operations = operation === 'mixed' ? ['add', 'subtract', 'multiply', 'divide'] : [operation];
      op = operations[Math.floor(Math.random() * operations.length)];
      
      switch(op) {
        case 'add':
          num1 = Math.floor(Math.random() * 11) + 2;
          num2 = Math.floor(Math.random() * 11) + 2;
          answer = num1 + num2;
          questionStr = `${num1} + ${num2} = ?`;
          break;
        case 'subtract':
          num1 = Math.floor(Math.random() * 11) + 2;
          num2 = Math.floor(Math.random() * num1) + 1;
          answer = num1 - num2;
          questionStr = `${num1} ‚àí ${num2} = ?`;
          break;
        case 'multiply':
          num1 = Math.floor(Math.random() * 11) + 2;
          num2 = Math.floor(Math.random() * 11) + 2;
          answer = num1 * num2;
          questionStr = `${num1} √ó ${num2} = ?`;
          break;
        case 'divide':
          num2 = Math.floor(Math.random() * 11) + 2;
          answer = Math.floor(Math.random() * 11) + 2;
          num1 = num2 * answer;
          questionStr = `${num1} √∑ ${num2} = ?`;
          break;
      }
      
      return { questionStr, answer };
    }

    function startGame() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      
      const nameLeft = document.getElementById('nameLeft').value.trim() || 'Pemain Kiri';
      const nameRight = document.getElementById('nameRight').value.trim() || 'Pemain Kanan';
      
      document.getElementById('playerLeftName').textContent = nameLeft;
      document.getElementById('playerRightName').textContent = nameRight;
      document.getElementById('labelLeft').textContent = nameLeft;
      document.getElementById('labelRight').textContent = nameRight;
      
      if (window.elementSdk) {
        window.elementSdk.setConfig({
          player_left_name: nameLeft,
          player_right_name: nameRight
        });
      }
      
      gameState.timeLimit = parseInt(document.getElementById('timeLimit').value);
      gameState.operation = document.getElementById('operationSelect').value;
      gameState.markerPosition = 50;
      gameState.scoreLeft = 0;
      gameState.scoreRight = 0;
      gameState.currentTurn = 'left';
      gameState.gameActive = true;
      
      document.getElementById('settingsPanel').style.display = 'none';
      document.getElementById('gameBoard').classList.add('active');
      
      updateScores();
      updateMarkerPosition();
      nextQuestion();
    }

    function updateScores() {
      document.getElementById('scoreLeft').textContent = gameState.scoreLeft;
      document.getElementById('scoreRight').textContent = gameState.scoreRight;
    }

    function updateMarkerPosition() {
      const marker = document.getElementById('ropeMarker');
      marker.style.left = gameState.markerPosition + '%';
    }

    function updateTurnIndicator() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const indicator = document.getElementById('turnIndicator');
      const playerName = gameState.currentTurn === 'left' 
        ? (config.player_left_name || defaultConfig.player_left_name)
        : (config.player_right_name || defaultConfig.player_right_name);
      indicator.textContent = `Giliran: ${playerName}`;
    }

    function nextQuestion() {
      if (!gameState.gameActive) return;
      
      const question = generateQuestion(gameState.operation);
      gameState.currentQuestion = question.questionStr;
      gameState.correctAnswer = question.answer;
      gameState.timeRemaining = gameState.timeLimit;
      
      document.getElementById('questionText').textContent = question.questionStr;
      document.getElementById('answerLeft').value = '';
      document.getElementById('answerRight').value = '';
      
      // Show only the current player's input
      const leftSection = document.getElementById('answerLeft').parentElement;
      const rightSection = document.getElementById('answerRight').parentElement;
      
      if (gameState.currentTurn === 'left') {
        leftSection.style.display = 'flex';
        rightSection.style.display = 'none';
        document.getElementById('answerLeft').disabled = false;
        document.getElementById('answerLeft').focus();
      } else {
        leftSection.style.display = 'none';
        rightSection.style.display = 'flex';
        document.getElementById('answerRight').disabled = false;
        document.getElementById('answerRight').focus();
      }
      
      updateTurnIndicator();
      startTimer();
    }

    function startTimer() {
      if (gameState.timerInterval) {
        clearInterval(gameState.timerInterval);
      }
      
      const timerBar = document.getElementById('timerBar');
      timerBar.style.width = '100%';
      
      gameState.timerInterval = setInterval(() => {
        gameState.timeRemaining -= 0.1;
        const percentage = (gameState.timeRemaining / gameState.timeLimit) * 100;
        timerBar.style.width = percentage + '%';
        
        if (percentage < 30) {
          timerBar.style.background = 'linear-gradient(90deg, #ef4444 0%, #dc2626 100%)';
        } else if (percentage < 60) {
          timerBar.style.background = 'linear-gradient(90deg, #f59e0b 0%, #d97706 100%)';
        } else {
          timerBar.style.background = 'linear-gradient(90deg, #4ade80 0%, #22c55e 100%)';
        }
        
        if (gameState.timeRemaining <= 0) {
          clearInterval(gameState.timerInterval);
          handleTimeout();
        }
      }, 100);
    }

    function handleTimeout() {
      clearInterval(gameState.timerInterval);
      
      setTimeout(() => {
        gameState.currentTurn = gameState.currentTurn === 'left' ? 'right' : 'left';
        nextQuestion();
      }, 500);
    }

    function checkAnswer(player) {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const input = player === 'left' ? document.getElementById('answerLeft') : document.getElementById('answerRight');
      const answer = parseInt(input.value);
      
      if (isNaN(answer)) return;
      
      clearInterval(gameState.timerInterval);
      document.getElementById('answerLeft').disabled = true;
      document.getElementById('answerRight').disabled = true;
      
      if (answer === gameState.correctAnswer) {
        showFeedback(config.correct_message || defaultConfig.correct_message, true);
        
        if (player === 'left') {
          gameState.scoreLeft++;
          gameState.markerPosition = Math.max(0, gameState.markerPosition - 10);
        } else {
          gameState.scoreRight++;
          gameState.markerPosition = Math.min(100, gameState.markerPosition + 10);
        }
        
        updateScores();
        updateMarkerPosition();
        
        // Check if marker reached the end (0% or 100%)
        if (gameState.markerPosition <= 0 || gameState.markerPosition >= 100) {
          setTimeout(() => {
            endGame();
          }, 1500);
          return;
        }
        
        setTimeout(() => {
          gameState.currentTurn = gameState.currentTurn === 'left' ? 'right' : 'left';
          nextQuestion();
        }, 1500);
      } else {
        setTimeout(() => {
          gameState.currentTurn = gameState.currentTurn === 'left' ? 'right' : 'left';
          nextQuestion();
        }, 500);
      }
    }

    function showFeedback(message, isCorrect) {
      const feedback = document.getElementById('feedbackMessage');
      feedback.textContent = message;
      feedback.className = 'feedback-message show ' + (isCorrect ? 'correct' : 'wrong');
      
      setTimeout(() => {
        feedback.classList.remove('show');
      }, 1200);
    }

    function createFirework(x, y) {
      const colors = ['#ff0000', '#ff7f00', '#ffff00', '#00ff00', '#0000ff', '#4b0082', '#9400d3', '#ff1493', '#00ffff', '#ffd700'];
      const particles = 30;
      
      for (let i = 0; i < particles; i++) {
        const particle = document.createElement('div');
        particle.className = 'firework-particle';
        particle.style.left = x + 'px';
        particle.style.top = y + 'px';
        particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        
        const angle = (Math.PI * 2 * i) / particles;
        const velocity = 100 + Math.random() * 100;
        const tx = Math.cos(angle) * velocity;
        const ty = Math.sin(angle) * velocity;
        
        particle.style.setProperty('--tx', tx + 'px');
        particle.style.setProperty('--ty', ty + 'px');
        
        document.body.appendChild(particle);
        
        setTimeout(() => particle.remove(), 1000);
      }
    }
    
    function createConfetti() {
      const colors = ['#ff0000', '#ff7f00', '#ffff00', '#00ff00', '#0000ff', '#ff1493', '#ffd700', '#00ffff'];
      const confettiCount = 100;
      
      for (let i = 0; i < confettiCount; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.style.left = Math.random() * 100 + '%';
          confetti.style.top = '-10px';
          confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.animationDelay = Math.random() * 0.5 + 's';
          confetti.style.animationDuration = (2 + Math.random() * 2) + 's';
          
          document.body.appendChild(confetti);
          
          setTimeout(() => confetti.remove(), 5000);
        }, i * 30);
      }
    }
    
    function celebrateWinner() {
      createConfetti();
      
      const fireworkInterval = setInterval(() => {
        const x = Math.random() * window.innerWidth;
        const y = Math.random() * (window.innerHeight * 0.6);
        createFirework(x, y);
      }, 200);
      
      setTimeout(() => clearInterval(fireworkInterval), 3000);
    }
    
    function endGame() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      gameState.gameActive = false;
      clearInterval(gameState.timerInterval);
      
      // Determine winner based on marker position
      const winner = gameState.markerPosition <= 0 
        ? (config.player_left_name || defaultConfig.player_left_name)
        : (config.player_right_name || defaultConfig.player_right_name);
      
      // Update total wins
      if (gameState.markerPosition <= 0) {
        gameState.totalWinsLeft++;
      } else {
        gameState.totalWinsRight++;
      }
      
      // Update popup with player names and win counts
      document.getElementById('popupNameLeft').textContent = config.player_left_name || defaultConfig.player_left_name;
      document.getElementById('popupNameRight').textContent = config.player_right_name || defaultConfig.player_right_name;
      document.getElementById('popupWinsLeft').textContent = gameState.totalWinsLeft;
      document.getElementById('popupWinsRight').textContent = gameState.totalWinsRight;
      
      document.getElementById('winnerText').textContent = `${winner} Menang!`;
      document.getElementById('gameOverScreen').classList.add('show');
      
      celebrateWinner();
    }

    function restartGame() {
      document.getElementById('gameOverScreen').classList.remove('show');
      
      // Update win record table
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      document.getElementById('recordWinsLeft').textContent = gameState.totalWinsLeft;
      document.getElementById('recordWinsRight').textContent = gameState.totalWinsRight;
      document.getElementById('recordNameLeft').textContent = config.player_left_name || defaultConfig.player_left_name;
      document.getElementById('recordNameRight').textContent = config.player_right_name || defaultConfig.player_right_name;
      document.getElementById('winRecordTable').style.display = 'block';
      
      gameState.markerPosition = 50;
      gameState.scoreLeft = 0;
      gameState.scoreRight = 0;
      gameState.currentTurn = 'left';
      gameState.gameActive = true;
      
      updateScores();
      updateMarkerPosition();
      nextQuestion();
    }

    function exitGame() {
      document.getElementById('gameOverScreen').classList.remove('show');
      document.getElementById('gameBoard').classList.remove('active');
      document.getElementById('settingsPanel').style.display = 'block';
      
      document.getElementById('nameLeft').value = '';
      document.getElementById('nameRight').value = '';
      document.getElementById('operationSelect').value = 'mixed';
      document.getElementById('timeLimit').value = '10';
      
      // Reset all game state including win records
      gameState.gameActive = false;
      gameState.totalWinsLeft = 0;
      gameState.totalWinsRight = 0;
      document.getElementById('winRecordTable').style.display = 'none';
    }

    document.getElementById('startBtn').addEventListener('click', startGame);
    document.getElementById('restartBtn').addEventListener('click', restartGame);
    document.getElementById('exitBtn').addEventListener('click', exitGame);

    document.getElementById('answerLeft').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        checkAnswer('left');
      }
    });

    document.getElementById('answerRight').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        checkAnswer('right');
      }
    });
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a45d4c5b3bbdce2',t:'MTc2NDEyMjgzNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>